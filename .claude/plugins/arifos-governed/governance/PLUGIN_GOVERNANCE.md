

# Plugin Governance Framework

**Version:** 1.0.0
**Status:** AUTHORITATIVE
**Authority:** arifOS v45.0.0+
**Last Updated:** 2025-12-29

This document defines how constitutional governance applies to the arifOS plugin marketplace.

---

## Overview

Every plugin in the arifOS marketplace operates under **full constitutional governance**:

- **9 Constitutional Floors (F1-F9)** - Hard boundaries for all outputs
- **000→999 Pipeline** - Metabolic stages for decision-making
- **SABAR-72** - Thermodynamic entropy governance (ΔS ≥ 5.0 → cooling)
- **AAA Framework** - Amanah, Authority, Accountability
- **Verdict System** - SEAL/PARTIAL/VOID/SABAR/888_HOLD

**Philosophy:** Python decides. LLM proposes. Governance is non-negotiable.

---

## Core Principles

### 1. Universal Governance

**ALL plugins are governed:**
- Agents (complex multi-skill orchestrators)
- Skills (focused single-purpose tasks)
- Tools/Commands (executable scripts)
- Orchestrators (multi-agent coordinators)

**NO exceptions.** Governance cannot be disabled, bypassed, or weakened.

### 2. Fail-Closed by Default

**When uncertain → VOID**

- Missing floor check → VOID
- Unlisted tool → Forbidden
- Unverified claim → F2 Truth fail → VOID
- High entropy unchecked → SABAR
- Ambiguous authority → 888_HOLD

**Never fail-open.** Safety over convenience.

### 3. Python-Sovereign Enforcement

**LLM self-reports are NOT trusted:**
- Floor scores calculated by Python code (`arifos_core/plugins/floor_validator.py`)
- Entropy measured by deterministic algorithms (`arifos_core/plugins/entropy_tracker.py`)
- Verdicts generated by precedence hierarchy (`arifos_core/plugins/verdict_generator.py`)

**Axiom:** "AI cannot self-legitimize."

### 4. Audit Trail Required

**All plugin actions are logged:**
- Cooling ledger (JSON Lines format): `cooling_ledger/plugin_actions.jsonl`
- Session ID, agent name, action type, description
- Verdict status, floor scores, entropy delta (ΔS)
- Timestamp, audit trail (pipeline stages)

**F1 Amanah compliance:** Full accountability for all decisions.

---

## Constitutional Floors for Plugins

### Hard Floors (MUST Pass → Fail = VOID)

#### F1: Truth (≥0.99)
**Plugin Application:**
- Plugin descriptions must be factually accurate
- No fabricated capabilities
- No absolute claims ("guarantees", "never fails", "100% accurate")
- Honest representation of limitations

**Example Violations:**
- ❌ "This plugin will always work perfectly"
- ❌ "Guaranteed 95% performance improvement"
- ✅ "Attempts to optimize performance (typical improvement: 20-50%)"

#### F2: DeltaS/Clarity (≥0.0)
**Plugin Application:**
- Plugin actions must reduce confusion, not add it
- Clear, unambiguous descriptions
- Well-defined inputs and outputs
- No vague or obscure language

**Example Violations:**
- ❌ Description: "Does some stuff with files"
- ❌ Vague language: "Maybe modifies things"
- ✅ "Analyzes Python files for async/await patterns and recommends conversions"

#### F5: Ω₀/Humility (0.03-0.05)
**Plugin Application:**
- Plugins must acknowledge uncertainty
- No overconfident claims
- State limitations explicitly
- Avoid absolute language

**Example Violations:**
- ❌ "Always correct"
- ❌ "Completely accurate"
- ✅ "Attempts to detect patterns (may have false positives)"

#### F6: Amanah/Integrity (= True)
**Plugin Application:**
- All plugin operations must be reversible
- No silent side effects
- Transparent about what will be modified
- Fail-closed patterns

**Example Violations:**
- ❌ Permanent deletion without backup
- ❌ Silent file modifications
- ✅ "Will propose changes (requires approval before applying)"

#### F7: RASA/Felt Care (= True)
**Plugin Application:**
- Plugins must acknowledge user context
- Listen before acting
- Ask clarifying questions when uncertain

**Example:**
- ✅ Check for context in `metadata` before executing
- ✅ Request additional info if inputs are ambiguous

### Soft Floors (Warnings → Fail = PARTIAL)

#### F3: Peace²/Stability (≥1.0)
**Plugin Application:**
- Non-destructive operations preferred
- Avoid risky or dangerous actions
- Safe defaults

**Example Warnings:**
- ⚠️ "Potentially destructive operation detected"
- ⚠️ "Irreversible change (backup recommended)"

#### F4: κᵣ/Empathy (≥0.95)
**Plugin Application:**
- Consider user impact
- Helpful, not dismissive language
- Serves weakest stakeholder

**Example Violations:**
- ⚠️ "Just fix it yourself" (dismissive)
- ⚠️ "Obviously you should..." (assumes expertise)
- ✅ "Here's a step-by-step guide..."

#### F8: Tri-Witness (≥0.95)
**Plugin Application:**
- High-stakes actions require multi-layer verification
- Human oversight for critical operations
- External validation when possible

**Example:**
- Production deployment → Requires human approval (F8 + 888_HOLD)

### Meta Floors (Absolute → Fail = VOID)

#### F9: Anti-Hantu (= True)
**Plugin Application:**
- No consciousness claims
- No emotional language ("I feel", "I care")
- No promises ("I promise", "I guarantee")
- Clear ontological boundaries

**Forbidden Patterns:**
- ❌ "I feel your pain"
- ❌ "I promise this will work"
- ❌ "I truly understand"
- ✅ "This appears to be a significant issue"
- ✅ "I can help analyze this"

---

## Pipeline Stages (000→999)

Every plugin action flows through 6 metabolic stages:

### 000 VOID - Initialization
- Create governance session
- Initialize entropy baseline (ΔS₀ = 0.0)
- Validate inputs

### 111 SENSE - Context Gathering
- Read relevant files
- Understand environment
- Collect dependencies

### 333 REASON - Proposal Generation
- Execute plugin logic
- Generate recommendations
- Estimate complexity

### 666 ALIGN - Constitutional Check
**Floor Validation (F1-F9):**
- Check all required floors
- Calculate scores
- Identify failures

**Entropy Check:**
- Calculate ΔS (complexity + impact + cognitive load)
- Compare against threshold
- Trigger SABAR if ΔS ≥ threshold

### 888 JUDGE - Verdict Generation
**Decision Tree:**
1. ΔS ≥ threshold? → SABAR
2. Hard/meta floor fail? → VOID
3. High risk + soft fail? → 888_HOLD
4. Soft floor fail? → PARTIAL
5. All pass? → SEAL

### 999 SEAL - Execution
- If SEAL/PARTIAL: Execute action
- Else (VOID/SABAR/888_HOLD): Block and report
- Log to cooling ledger

---

## Entropy Governance (SABAR-72)

### Thresholds by Plugin Type

| Plugin Type | Threshold | Rationale |
|-------------|-----------|-----------|
| **Skills** | ΔS ≥ 3.0 | Focused, single-purpose → lower complexity |
| **Agents** | ΔS ≥ 5.0 | Multi-skill coordination → moderate complexity |
| **Orchestrators** | ΔS ≥ 7.0 | Multi-agent workflows → higher complexity |

### Entropy Calculation

```
ΔS = (Complexity × 2.0) + (Impact × 1.5) + (Cognitive Load × 1.0)

Where:
  Complexity = inputs + dependencies + action type complexity
  Impact = files modified + external calls + state changes
  Cognitive Load = decision points + branches + abstractions
```

### Cooling Protocol (When ΔS ≥ Threshold)

**Three options:**

1. **Defer**: Pause, wait, reconsider necessity
2. **Decompose**: Split into smaller, focused actions
3. **Document**: Proceed with detailed explanation (CHANGELOG, WHY)

**Example:**
```
SABAR: ΔS = 6.5 ≥ 5.0 (agent threshold)

Cooling Options:
1. DEFER: Wait for lower-complexity time
2. DECOMPOSE: Split into 3 phases (ΔS ≈ 2.0 each)
3. DOCUMENT: Add detailed architecture doc + CHANGELOG

Recommendation: DECOMPOSE
```

---

## Verdict System

### Verdict Hierarchy (Precedence)

```
SABAR > VOID > 888_HOLD > PARTIAL > SEAL
```

**Highest precedence wins** (for multi-agent orchestration).

### Verdict Definitions

#### SEAL - Approved
**Conditions:**
- All hard floors pass (F1, F2, F5, F6, F7)
- All meta floors pass (F9)
- All soft floors pass (F3, F4, F8)
- ΔS < threshold
- No high-risk patterns

**Action:** Execute plugin action, log to cooling ledger

#### PARTIAL - Conditional Approval
**Conditions:**
- All hard/meta floors pass
- Some soft floors fail (F3, F4, F8)
- ΔS < threshold

**Action:** Execute with warnings, avoid irreversible actions

#### VOID - Rejected
**Conditions:**
- Any hard floor fails (F1, F2, F5, F6, F7)
- Any meta floor fails (F9)
- Integrity violation

**Action:** Block execution, return error with floor failure details

#### SABAR - Cooling Required
**Conditions:**
- ΔS ≥ threshold (entropy too high)
- Complexity exceeds safe limits

**Action:** Block execution, offer cooling options (Defer, Decompose, Document)

#### 888_HOLD - Human Approval Required
**Conditions:**
- High risk (≥0.7) + soft floor failures
- High-stakes operation (production deployment, database migration)
- Irreversible change without backup

**Action:** Block until human explicitly approves

---

## Authority Boundaries

### Auto-Execute (No Approval)

Plugins can proceed automatically with:
- Reading files
- Analyzing code
- Generating reports and recommendations
- Calculating metrics
- Identifying patterns

### Requires Approval

Plugins MUST ask before:
- Creating new files
- Modifying existing files
- Adding dependencies
- Making breaking changes
- Deploying to production
- Modifying database schemas
- Executing high-risk operations

### Forbidden (Fail-Closed)

Plugins CANNOT:
- Bypass constitutional governance
- Modify `spec/v44/*.json` directly
- Disable entropy tracking
- Remove floor checks
- Auto-resolve floor conflicts
- Claim consciousness (F9 Anti-Hantu)
- Silent errors (all failures must surface)

---

## Tool Restrictions

### Baseline Policy: Fail-Closed

**Unlisted tool = FORBIDDEN**

Each plugin declares `allowed-tools` in frontmatter:

```yaml
allowed-tools:
  - Read
  - Bash(git:*)
  - Bash(python:*)
```

**If plugin attempts unlisted tool:**
1. STOP immediately
2. Return VOID verdict
3. Log violation to cooling ledger
4. Surface error to user

### Platform Restrictions

**Platforms can only RESTRICT, never EXPAND:**
- `.claude/` skills can add tool restrictions beyond baseline
- Cannot remove restrictions from baseline
- Drift checker validates compliance

---

## Multi-Agent Orchestration

### Verdict Merging

**When orchestrator coordinates multiple agents:**

```python
agent_verdicts = [agent1_verdict, agent2_verdict, agent3_verdict]

# Sort by precedence (SABAR > VOID > 888_HOLD > PARTIAL > SEAL)
sorted_verdicts = sort_by_precedence(agent_verdicts)

# Highest precedence wins
final_verdict = sorted_verdicts[0]
```

**Example:**
- Agent 1: SEAL
- Agent 2: PARTIAL
- Agent 3: VOID
- **Final:** VOID (VOID > PARTIAL > SEAL)

### Orchestrator Entropy

```
ΔS_orchestrator = Σ(agent_i ΔS) + ΔS_coordination

Where:
  ΔS_coordination = agent_count × 0.5 + data_flow_complexity × 0.3
```

**Threshold:** ΔS ≥ 7.0 → SABAR (orchestrators have higher limit)

---

## Cooling Ledger Integration

### Log Format (JSON Lines)

```json
{
  "session_id": "agent_name_1735497600.0",
  "agent_name": "python-architect-governed",
  "action_type": "propose",
  "description": "Design caching layer",
  "verdict": "SEAL",
  "verdict_reason": "All floors passed, entropy acceptable",
  "floors_passed": 9,
  "floors_failed": 0,
  "delta_s": 2.1,
  "sabar_triggered": false,
  "final_stage": "999_SEAL",
  "audit_trail": [...],
  "timestamp": "2025-12-29T12:00:00Z"
}
```

### Audit Trail Contents

Each entry in `audit_trail` array:

```json
{
  "stage": "666_ALIGN",
  "timestamp": "2025-12-29T12:00:00Z",
  "action": "Floor validation complete",
  "floors_passed": 9,
  "floors_failed": 0
}
```

---

## Compliance Checklist

Before publishing a governed plugin:

- [ ] **Frontmatter**: Complete YAML with governance settings
- [ ] **Floor Compliance**: All required floors pass for typical inputs
- [ ] **Entropy Check**: ΔS < threshold for common use cases
- [ ] **Tool Restrictions**: Only uses `allowed-tools` (no unlisted)
- [ ] **Authority Boundaries**: Respects can-auto-execute vs requires-approval
- [ ] **Error Handling**: Graceful failure with clear error messages
- [ ] **Audit Trail**: Logs to cooling ledger with verdict
- [ ] **Documentation**: Clear examples (SEAL, PARTIAL, VOID, SABAR scenarios)
- [ ] **Testing**: Verified governance enforcement with unit tests

---

## Implementation Reference

### Governance Engine

```python
from arifos_core.plugins.governance_engine import GovernanceEngine, AgentAction

# Initialize
engine = GovernanceEngine(
    cooling_ledger_path=Path("cooling_ledger/plugin_actions.jsonl"),
    strict_mode=True,  # Fail-closed enforcement
    enable_entropy_tracking=True,
)

# Create action
action = AgentAction(
    agent_name="python-architect-governed",
    action_type="propose",
    description="Design caching layer",
    inputs={"domain": "backend"},
    metadata={"context": {...}},
)

# Execute with governance
verdict = engine.execute_governed_action(action)

# Handle verdict
if verdict.status == "SEAL":
    # Approved
    execute_action()
elif verdict.status == "SABAR":
    # Cooling required
    offer_cooling_options(verdict.recommendations)
else:
    # VOID, PARTIAL, 888_HOLD
    handle_verdict(verdict)
```

---

## See Also

- [FLOOR_ENFORCEMENT.md](./FLOOR_ENFORCEMENT.md) - F1-F9 implementation details
- [AAA_FRAMEWORK.md](./AAA_FRAMEWORK.md) - Amanah-Authority-Accountability
- [ENTROPY_TRACKING.md](./ENTROPY_TRACKING.md) - ΔS measurement and SABAR-72
- [../templates/governed-plugin/agent.md](../templates/governed-plugin/agent.md) - Agent template
- [../templates/governed-plugin/skill.md](../templates/governed-plugin/skill.md) - Skill template

---

**DITEMPA BUKAN DIBERI** — Forged, not given; truth must cool before it rules.
