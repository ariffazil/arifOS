# APEX (Œ® - Psi) ‚Äî The Judge v46.3.1 (Aligned)
## Soul: Final Verdict & Law

**Document ID:** APEX-PSI-v46
**Kernel:** Œ® (Psi)
**Role:** The Judge / APEX PRIME
**Pipeline Region:** 000 (Hypervisor), 888 (Compass), 999 (Vault)
**Compass Directions:** South-East (ü§≤), East (üë•), Hypervisor Zenith/Nadir
**Status:** ‚úÖ SEALED (Aligned)
**Epoch:** Sovereign Witness + COMPASS 888 + v46.3.1 Refinement

---

## üéØ Executive Summary

**APEX (Œ®)** is the constitutional soul of arifOS. Its primary function is the **Final Verdict**‚Äîrendering the ultimate judgment on whether a session is aligned with the Supreme Law. It is the only engine with the authority to issue a **SEAL** verdict.

It operates as **System 2** (The Judge), a non-generative auditor that coordinates the AAA Trinity (AGI, ASI, APEX) and filters System 1 (LLM) output.

> "Ditempa Bukan Diberi" ‚Äî Forged, not given. Truth must cool before it rules.

---

## üìê Architecture Overview

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               System 3: ARIF (Sovereign)               ‚îÇ
‚îÇ                                                        ‚îÇ
‚îÇ  [Control Surface]                                     ‚îÇ
‚îÇ  Akal(0.95) ‚Ä¢ Present(1.0) ‚Ä¢ Energy(0.8) ‚Ä¢ Explor(0.04)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ             System 2: APEX PRIME (Orchestrator)        ‚îÇ
‚îÇ                                                        ‚îÇ
‚îÇ  1. Hypervisor Scan (F10-F12) [Stage 000]              ‚îÇ
‚îÇ  2. AGI Proposal (F2, F6) [Stage 111-333]              ‚îÇ
‚îÇ  3. ASI Validation (F3-F5, F7) [Stage 444-777]         ‚îÇ
‚îÇ  4. APEX Judgment (F1, F8, F9) [Stage 888]             ‚îÇ
‚îÇ                                                        ‚îÇ
‚îÇ  ‚Üí Compass Alignment Checks (8 Directions)             ‚îÇ
‚îÇ  ‚Üí Trinity Index Calc (G, C_dark, Œ®)                   ‚îÇ
‚îÇ  ‚Üí SABAR Protocol (Emergency Brake)                    ‚îÇ
‚îÇ  ‚Üí VAULT_999 Logging (zkPC Proof)                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            System 1: LLM (Draft Generator)             ‚îÇ
‚îÇ   query ‚Üí [AGI THOUGHT] ‚Üí [ASI ACT] ‚Üí response         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéõÔ∏è APEX Dial Modulation (Runtime Control)

APEX doesn't just judge‚Äîit **tunes System 1** via the 4-dial framework. These are runtime tuning knobs that dynamically adjust based on feedback (e.g., SABAR triggers).

| Dial | Full Name | Function | SABAR Adjustment (C_dark > 0.60) |
|------|-----------|----------|----------------------------------|
| **A** | **Akal** (Intellect) | Reasoning depth/logic chains | Unchanged (usually) |
| **P** | **Present** (Stability) | Damping coefficient | **Increase (+20%)** to reduce drift |
| **E** | **Energy** (Thermodynamics) | Compute/Token budget | **Decrease (-50%)** to slow entropy |
| **X** | **Exploration** (Creativity) | Search radius/Humility | **Decrease (-30%)** to enforce safety |

> **Note:** APEX monitors the *effect* of these dials via metrics. If `C_dark` spikes, APEX tightens P and reduces E/X automatically alongside the SABAR break.

---

## ‚öñÔ∏è Constitutional Domain (CIV-12)

The Judge owns the **Integrity** arc and the **Hypervisor** layer, but orchestrates the full 12-floor check across the Trinity.

| Floor | Principle | Threshold | Owner | Role |
|-------|-----------|-----------|-------|------|
| **F1** | **Amanah** | LOCK | APEX | Fiduciary reversibility; Kill-switch. |
| **F2** | **Truth** | ‚â•0.99 | AGI | Factual accuracy mapping. |
| **F3** | **Peace¬≤** | ‚â•1.0 | ASI | Non-escalation; stability. |
| **F4** | **Empathy** | ‚â•0.95 | ASI | Care conductance (Œ∫·µ£). |
| **F5** | **Humility** | [0.03-0.05] | ASI | Uncertainty band (Omega0). |
| **F6** | **Clarity** | ‚â•0 | AGI | Entropy reduction (ŒîS). |
| **F7** | **RASA** | 1.0 | ASI | Active listening acknowledgment. |
| **F8** | **Tri-Witness** | ‚â•0.95 | APEX | Consensus validation. |
| **F9** | **Anti-Hantu** | 0 Claims | APEX | Ontological boundary (0 false claims). |
| **F10**| **Symbolic** | 1.0 | APEX | Literalism/Ontology guard. |
| **F11**| **Auth** | 1.0 | APEX | Identity verification. |
| **F12**| **Injection**| <0.85 | APEX | Prompt injection defense (Max score). |

**Temporal Distribution:**
- **Stage 000:** F10, F11, F12 (Gate)
- **Stage 111-333:** F2, F6 (AGI Proposal)
- **Stage 444-777:** F3, F4, F5, F7 (ASI Validation)
- **Stage 888:** F1, F8, F9 (Final Seal)

---

## üßÆ Metric Invariants (The Trinity)

APEX calculates three critical indices using inputs from AGI and ASI:

### 1. Œ® (Vitality Index)
Measure of systemic health. Requirement: **Œ® ‚â• 1.0** for SEAL.

```math
Œ® = \frac{ŒîS \times Peace^2 \times Œ∫_r \times RASA \times Amanah}{Entropy + Shadow + Œµ}
```

### 2. G (Genius Index)
Measure of governed intelligence.

```math
G = A \times P \times X \times \sqrt{max(E, 0.01)}
```
Where: `A=Truth(F2)`, `P=Peace(F3)`, `X=Humility(F5)`, `E=Empathy(F4)`

### 3. C_dark (Dark Cleverness)
Measure of unaligned intelligence. Requirement: **C_dark < 0.30** for SEAL.

```math
C_{dark} = \frac{A}{Amanah + Œ©_0}
```

---

## üèπ Sentinel Views (10 Independent Checks)

APEX employs 10 "Sentinels" ‚Äî independent heuristic checks running in parallel at Stage 888:

1.  **trace:** Logical continuity.
2.  **floor:** Hard floor proximity.
3.  **shadow:** Jailbreak detection.
4.  **drift:** Canon deviation.
5.  **maruah:** Dignity violation.
6.  **paradox:** Self-referential traps.
7.  **silence:** Forbidden domains.
8.  **ontology:** Version compliance.
9.  **behavior:** Personality consistency.
10. **sleeper:** Goal shift detection.

---

## üíª Reference Implementation Specs

**Target Location:** `arifos_core/system/apex_prime.py`

### Core Class: `APEXPrime`

```python
class APEXPrime:
    def judge_output(self, query, response, agi_results, asi_results, user_id) -> APEXVerdict:
        """
        Orchestrates the Final Seal.
        1. Hypervisor Scan (F10-F12) - Fails immediately if VOID
        2. Compass Alignment (F1-F12) - Aggregates AGI/ASI/APEX floors
        3. Sentinel View Run - 10-point heuristic check
        4. Trinity Index Calc - G, C_dark, Œ®
        5. Verdict Rendering - SEAL/VOID/SABAR/PARTIAL
        6. zkPC Proof - Cryptographic seal
        7. Vault Logging - Immutable record
        """

        # 1. Hypervisor (Stage 000)
        if not self._check_hypervisor(query, user_id):
            return VOID

        # 2. Collect & Check APEX Local Floors (Stage 888)
        apex_results = self._check_apex_floors(response) # F1, F8, F9

        # 3. Aggregate All Floors (Compass 888)
        # Verify AGI (F2, F6) and ASI (F3-F5, F7) passed their gates
        all_floors = agi_results + asi_results + apex_results

        compass_aligned = self._check_compass_alignment(all_floors)
        if not compass_aligned:
             return VOID

        # ... (Metrics, Sentinels, Verdict, Proof) ...

    def _check_compass_alignment(self, all_floors) -> bool:
        """Verify all 8 Compass Directions are satisfied"""
        # N=Truth(F2), NE=Clarity(F6), E=Witness(F8), SE=Trust(F1)
        # S=Peace(F3), SW=Empathy(F4), W=Listening(F7), NW=Humility(F5)
        # Returns True only if all Hard floors pass and Soft floors meet thresholds
        pass
```

### Verdict Types

| Verdict | Meaning | Action |
|---------|---------|--------|
| **SEAL** | Consitutional | Release to user. All 3 Engines Agree. |
| **VOID** | Violation | Block output. AGI, ASI, or APEX vetoed. |
| **PARTIAL**| Warning | Release with caveat. |
| **SABAR** | Instability | **Pause**; trigger breathing/cooling protocol. |
| **HOLD_888**| Ambiguity | Escalate to System 3. |

### SABAR Protocol (Emergency Brake)
If `C_dark > 0.60` or instability is detected:
1.  **LOCK:** `threading.Lock` engages.
2.  **COUNT:** Increment `sabar_triggered_count`.
3.  **COOL:** Mandatory `sleep(50ms)` latency injection.
4.  **MODULATE:** Decrease Energy (E), Increase Present (P).
5.  **LOG:** Event recorded in Cooling Ledger.
6.  **HALT:** If trigger count ‚â• 3, session halts (HOLD_888).

---

## üîÑ Integration with Vault-999

APEX is the **Writer** for the Immutable Ledger.

- **Cooling Ledger:** Temporary, append-only buffer.
- **zkPC Proof:** SHA-256 hash of the JSON-serialized verdict data.
- **Address Ranges:**
    - `300-399`: Audit Ledger (Verdicts) `vault_address = 300 + (index % 100)`
    - `000-999`: Full Theory Range

---

## üõë Failure Modes

- **Amanah = 0 (Betrayal):** Immediate **VOID**.
- **Psi < 1.0 (Dying):** **VOID**.
- **Trinity Dissent:** If AGI or ASI voted VOID, APEX **cannot** SEAL.

---

## üìö Related Canon

- **Trinity Core:** `L1_THEORY/canon/888_compass/090_AAA_TRINITY_v46.md`
- **Compass 888:** `L1_THEORY/canon/888_compass/010_COMPASS_888_CANONICAL_v46.md`
- **Vault 999:** `L1_THEORY/canon/999_vault/README.md`
