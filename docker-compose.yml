version: '3.8'

services:
  arifos:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    environment:
      PORT: 8000
      LOG_LEVEL: info
    volumes:
      - ./ledger:/app/ledger              # Constitutional ledger
      - ./sessions:/app/sessions          # Agent sessions
      - ./logs:/app/logs                  # Application logs
      - ./L1_THEORY:/app/L1_THEORY:ro    # Read-only constitutional canon
      - ./L2_PROTOCOLS:/app/L2_PROTOCOLS:ro # Read-only protocols
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

  # Optional: Cloudflare Tunnel (if you want local -> public)
  # Uncomment if needed
  # cloudflare-tunnel:
  #   image: cloudflare/cloudflared:latest
  #   command: tunnel run --token ${CLOUDFLARE_TUNNEL_TOKEN}
  #   depends_on:
  #     - arifos
  #   environment:
  #     CLOUDFLARE_TUNNEL_TOKEN: ${CLOUDFLARE_TUNNEL_TOKEN}
